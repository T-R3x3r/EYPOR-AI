<div class="output-display">
  <div class="output-header">
    <h4>Execution Output</h4>
    <button class="clear-btn" (click)="clearOutput()">Clear All</button>
  </div>
  
  <div #outputContainer class="output-container" (scroll)="onScroll($event)">
    <div *ngIf="!executionResults.length" class="no-output">
      <p>No executions yet. Run a Python file or install requirements to see output here.</p>
    </div>
    
    <div *ngFor="let result of executionResults; let i = index" 
         class="execution-result" 
         [ngClass]="getOutputClass(result)"
         [style.height.px]="result.height || 'auto'">
      
      <div class="execution-header">
        <span class="timestamp">{{ formatTimestamp(result.timestamp) }}</span>
        <span class="command">{{ result.command }}</span>
        <span *ngIf="result.isRunning" class="running-indicator">Running...</span>
      </div>
      
      <div class="execution-content">
        <div *ngIf="result.output" class="execution-output">
          <pre>{{ result.output }}</pre>
        </div>
        
        <div *ngIf="result.error" class="execution-error">
          <pre>{{ result.error }}</pre>
        </div>
        
        <!-- Display generated files -->
        <div *ngIf="result.outputFiles && result.outputFiles.length > 0" class="output-files">
          <h5>Generated Files (Current Query):</h5>
          <div class="file-list">
            <div *ngFor="let file of result.outputFiles" class="output-file">
              <div class="file-info">
                <i class="fas" [ngClass]="getFileIcon(file.filename)"></i>
                <span class="file-name">{{ file.filename }}</span>
                
                <div class="file-actions">
                  <!-- View button for images -->
                  <button *ngIf="file.type === 'image'" 
                          class="view-btn" 
                          (click)="toggleImageVisibility(file)">
                    {{ file.isVisible ? 'Hide' : 'View' }}
                  </button>
                  
                  <!-- Download link -->
                  <a [href]="getFileDownloadUrl(file)" 
                     target="_blank" 
                     class="download-link">
                    <i class="fas fa-download"></i> Download
                  </a>
                  
                  <!-- Test button -->
                  <button *ngIf="file.type === 'image'" 
                          class="test-btn" 
                          (click)="testImageAccess(file)">
                    Test Access
                  </button>
                </div>
              </div>
              
              <!-- Display images -->
              <div *ngIf="file.type === 'image' && file.isVisible" 
                   class="image-preview">
                <div class="image-status">
                  <p>Status: <span id="status-{{ file.filename }}">Loading...</span></p>
                  <p class="debug-info">Path: {{ file.path }}</p>
                  <p class="debug-info">URL: {{ getFileDownloadUrl(file) }}</p>
                </div>
                
                <img [src]="getFileDownloadUrl(file)" 
                     [alt]="file.filename" 
                     class="generated-image"
                     (click)="maximizeImage(file)"
                     (load)="onImageLoad(file)"
                     (error)="onImageError(file, $event)"
                     onerror="this.style.display='none'" />
                
                <div *ngIf="file.error" class="image-error">
                  <p>Error loading image. Please check the file path and permissions.</p>
                </div>
              </div>
              
              <!-- Display HTML files -->
              <div *ngIf="file.type === 'html'" class="html-preview">
                <iframe [src]="getFileDownloadUrl(file) | safe" 
                        [title]="file.filename" 
                        class="generated-html" 
                        width="100%" 
                        height="400px"
                        frameborder="0">
                </iframe>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Show message when no files were generated during current query -->
        <div *ngIf="result.outputFiles && result.outputFiles.length === 0 && (result.output || result.error)" class="no-files-message">
          <p><em>No new files were generated during this query.</em></p>
        </div>
      </div>
      
      <!-- Resize handle -->
      <div class="resize-handle" 
           (mousedown)="startResize($event, i)"
           (touchstart)="startResize($event, i)">
        <div class="resize-bar"></div>
      </div>
    </div>
  </div>

  <!-- Maximized Image Overlay -->
  <div *ngIf="maximizedImage" 
       class="maximized-image-overlay"
       (click)="handleOverlayClick($event)">
    <div class="maximized-image-container">
      <button class="close-button" (click)="closeMaximizedImage()">Ã—</button>
      <img [src]="getFileDownloadUrl(maximizedImage)" 
           [alt]="maximizedImage.filename"
           class="maximized-image"
           (click)="$event.stopPropagation()" />
    </div>
  </div>
</div> 